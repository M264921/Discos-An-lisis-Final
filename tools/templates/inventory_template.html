<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Inventario Interactivo</title>
</head>
<body>
<script>
window.__INVENTARIO__ = {
  setData(rows, meta) {
    const safeRows = Array.isArray(rows) ? rows : [];
    const summary = (function buildSummary() {
      if (typeof meta === 'string' && meta.trim().length > 0) {
        return meta;
      }
      const drives = {};
      for (const entry of safeRows) {
        if (entry && entry.Drive) {
          const key = String(entry.Drive).trim().toUpperCase();
          if (key) {
            drives[key] = (drives[key] || 0) + 1;
          }
        }
      }
      const parts = Object.keys(drives).sort().map((key) => key + ': ' + drives[key] + ' files');
      return 'Total: ' + safeRows.length + (parts.length ? ' | ' + parts.join(' | ') : '');
    })();
    window.__DATA__ = safeRows;
    window.__META__ = summary;
    this._rows = safeRows;
    this._meta = summary;
    return safeRows;
  }
};

// Compat shim:
// - If legacy HTML exposes window.__DATA__ or window._DATA_, hydrate the viewer.
// - Always rebuild a quick meta summary with drive totals.
(function bootstrapLegacyDataset() {
  try {
    var rows = window.__DATA__ || window._DATA__ || null;
    if (Array.isArray(rows) && window.__INVENTARIO__ && typeof window.__INVENTARIO__.setData === 'function') {
      var driveTotals = {};
      for (var index = 0; index < rows.length; index++) {
        var record = rows[index];
        if (record && record.Drive) {
          var driveId = String(record.Drive).trim().toUpperCase();
          if (driveId) {
            driveTotals[driveId] = (driveTotals[driveId] || 0) + 1;
          }
        }
      }
      var driveKeys = Object.keys(driveTotals).sort();
      var meta = 'Total: ' + rows.length;
      if (driveKeys.length) {
        meta += ' | ' + driveKeys.map(function (key) {
          return key + ': ' + driveTotals[key] + ' files';
        }).join(' | ');
      }
      window.__INVENTARIO__.setData(rows, meta);
    }
  } catch (error) {
    // swallow compatibility errors silently
  }
})();
</script>
</body>
</html>

